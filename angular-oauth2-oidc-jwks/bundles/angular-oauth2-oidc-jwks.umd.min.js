!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("jsrsasign"),require("angular-oauth2-oidc")):"function"==typeof define&&define.amd?define("angular-oauth2-oidc-jwks",["exports","jsrsasign","angular-oauth2-oidc"],r):r((e=e||self)["angular-oauth2-oidc-jwks"]={},e.jsrsasign,e.angularOauth2Oidc)}(this,(function(e,r,t){"use strict";var n,o=this&&this.__extends||(n=function(e,r){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}n(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}),i=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.allowedAlgorithms=["HS256","HS384","HS512","RS256","RS384","RS512","ES256","ES384","PS256","PS384","PS512"],r.gracePeriodInSec=600,r}return o(t,e),t.prototype.validateSignature=function(e,t){var n=this;if(void 0===t&&(t=!1),!e.idToken)throw new Error("Parameter idToken expected!");if(!e.idTokenHeader)throw new Error("Parameter idTokenHandler expected.");if(!e.jwks)throw new Error("Parameter jwks expected!");if(!e.jwks.keys||!Array.isArray(e.jwks.keys)||0===e.jwks.keys.length)throw new Error("Array keys in jwks missing!");var o,i=e.idTokenHeader.kid,a=e.jwks.keys,s=e.idTokenHeader.alg;if(i)o=a.find((function(e){return e.kid===i}));else{var c=this.alg2kty(s),d=a.filter((function(e){return e.kty===c&&"sig"===e.use}));if(d.length>1){var u="More than one matching key found. Please specify a kid in the id_token header.";return console.error(u),Promise.reject(u)}1===d.length&&(o=d[0])}if(!o&&!t&&e.loadKeys)return e.loadKeys().then((function(r){return e.jwks=r})).then((function(r){return n.validateSignature(e,!0)}));if(!o&&t&&!i){u="No matching key found.";return console.error(u),Promise.reject(u)}if(!o&&t&&i){u="expected key not found in property jwks. This property is most likely loaded with the discovery document. Expected key id (kid): "+i;return console.error(u),Promise.reject(u)}var l=r.KEYUTIL.getKey(o),f={alg:this.allowedAlgorithms,gracePeriod:this.gracePeriodInSec};return r.KJUR.jws.JWS.verifyJWT(e.idToken,l,f)?Promise.resolve():Promise.reject("Signature not valid")},t.prototype.alg2kty=function(e){switch(e.charAt(0)){case"R":return"RSA";case"E":return"EC";default:throw new Error("Cannot infer kty from alg: "+e)}},t.prototype.calcHash=function(e,t){var n=new r.KJUR.crypto.MessageDigest({alg:t}).digestString(e),o=this.toByteArrayAsString(n);return Promise.resolve(o)},t.prototype.toByteArrayAsString=function(e){for(var r="",t=0;t<e.length;t+=2){var n=e.charAt(t)+e.charAt(t+1),o=parseInt(n,16);r+=String.fromCharCode(o)}return r},t}(t.AbstractValidationHandler);e.JwksValidationHandler=i,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-oauth2-oidc-jwks.umd.min.js.map